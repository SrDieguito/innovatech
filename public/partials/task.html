<!-- partials/tasks.html -->
<section id="tasks-root" class="space-y-6" data-course-id="" data-role="">
  <div class="flex items-center justify-between">
    <h3 class="text-xl font-semibold">Actividades de aprendizaje</h3>
    <button id="btnNuevaTarea"
      class="hidden px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">
      Nueva tarea
    </button>
  </div>

  <div class="flex items-center gap-3">
    <input id="buscarTarea" type="search" placeholder="Buscar..."
      class="w-full max-w-sm px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
    <!-- Filtro de estado solo visible para estudiantes -->
    <select id="filtroEstado"
      class="estudiante-only px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
      <option value="">Todos</option>
      <option value="pendiente">Pendiente</option>
      <option value="completada">Completada</option>
    </select>
  </div>

  <div id="listaTareas" class="grid gap-3"></div>

  <template id="tpl-tarea">
  <article 
    class="actividad-item cursor-pointer rounded-2xl border border-gray-200 p-4 shadow-sm bg-white hover:bg-green-50 transition"
    data-id="">
    <div class="flex items-start justify-between gap-4">
      <div class="min-w-0">
        <h4 class="font-medium text-gray-900 truncate" data-field="title"></h4>
        <p class="text-sm text-gray-500 mt-1 line-clamp-2" data-field="description"></p>
        <div class="mt-2 flex flex-wrap gap-3 text-sm text-gray-500">
          <span>Vence: <span data-field="due_at"></span></span>
          <span>Pts: <span data-field="points"></span></span>
          <!-- Estado solo visible para estudiantes -->
          <span class="estudiante-only">Estado: 
            <span data-field="status"
              class="px-2 py-0.5 rounded-full text-xs bg-gray-100 text-gray-700"></span>
          </span>
        </div>
        
        <!-- Sección de recomendaciones -->
        <div class="mt-3">
          <button class="reco-toggle px-3 py-1.5 text-xs rounded bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors"
                  data-tarea-id="">
            <i class="fas fa-lightbulb mr-1"></i>Ver recomendaciones
          </button>
          <div class="reco-container mt-2 hidden border rounded p-3 bg-gray-50 text-sm"></div>
        </div>
      </div>

      <!-- Acciones profesor -->
    </div>
  </article>
</template>


  <dialog id="modalTarea" class="rounded-2xl p-0 w-full max-w-xl backdrop:bg-black/30">
    <form id="formTarea" class="p-6 space-y-4">
      <h4 id="modalTitulo" class="text-lg font-semibold">Nueva tarea</h4>
      <input type="hidden" name="id">

      <label class="grid gap-1">
        <span class="text-sm text-gray-700">Título</span>
        <input name="title" required
          class="px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
      </label>

      <label class="grid gap-1">
        <span class="text-sm text-gray-700">Descripción</span>
        <textarea name="description" rows="4"
          class="px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500"></textarea>
      </label>

      <div class="grid grid-cols-2 gap-3">
        <label class="grid gap-1">
          <span class="text-sm text-gray-700">Vence (fecha y hora)</span>
          <input name="due_at" type="datetime-local" required
            class="px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
        </label>
        <label class="grid gap-1">
          <span class="text-sm text-gray-700">Puntos</span>
          <input name="points" type="number" min="0" value="100"
            class="px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
        </label>
      </div>

      <div class="pt-2 flex items-center justify-end gap-2">
        <button type="button" id="btnCancelarModal"
          class="px-4 py-2 rounded-xl border border-gray-200 hover:bg-gray-50">Cancelar</button>
        <button type="submit"
          class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Guardar</button>
      </div>
    </form>
  </dialog>

  <!-- Modal de entrega (estudiante) -->
  <dialog id="modalEntrega" class="rounded-2xl p-0 w-full max-w-md backdrop:bg-black/30">
    <form id="formEntrega" class="p-6 space-y-4" method="post" action="/api/entregas?action=subir" enctype="multipart/form-data">
      <h4 class="text-lg font-semibold">Entregar archivo</h4>
      <input type="hidden" name="tarea_id">
      <input type="hidden" name="curso_id">
      <div class="text-xs text-gray-600">Archivo actual: <span id="archivoActual">—</span></div>
      <label class="grid gap-1">
        <span class="text-sm text-gray-700">Archivo (máx 2 MB)</span>
        <input type="file" name="archivo" required
          class="px-3 py-2 rounded-xl border border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <span id="pesoArchivo" class="text-xs text-gray-500">—</span>
      </label>
      <div class="pt-2 flex items-center justify-end gap-2">
        <button type="button" id="btnCancelarEntrega"
          class="px-4 py-2 rounded-xl border border-gray-200 hover:bg-gray-50">Cancelar</button>
        <button type="submit"
          class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Subir</button>
      </div>
    </form>
  </dialog>
</section>

<script>
// Función para verificar el rol y mostrar/ocultar elementos
function configurarVistaPorRol() {
  const tasksRoot = document.getElementById('tasks-root');
  const role = tasksRoot.getAttribute('data-role');
  
  // Ocultar elementos específicos para profesores
  if (role === 'profesor') {
    const elementosEstudiante = document.querySelectorAll('.estudiante-only');
    elementosEstudiante.forEach(el => {
      el.style.display = 'none';
    });
    
    // También ocultar el botón de filtro de estado si existe
    const filtroEstado = document.getElementById('filtroEstado');
    if (filtroEstado) {
      filtroEstado.style.display = 'none';
    }
  }
}

// Ejecutar cuando el DOM esté cargado
document.addEventListener('DOMContentLoaded', configurarVistaPorRol);
</script>