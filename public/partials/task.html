<!-- partials/tasks.html -->
<section id="tasks-root" class="space-y-6" data-course-id="" data-role="">
  <div class="flex items-center justify-between">
    <h3 class="text-xl font-semibold">Actividades de aprendizaje</h3>
    <button id="btnNuevaTarea"
      class="hidden px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">
      Nueva tarea
    </button>
  </div>

  <div class="flex items-center gap-3">
    <input id="buscarTarea" type="search" placeholder="Buscar..."
      class="w-full max-w-sm px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
    <select id="filtroEstado"
      class="px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
      <option value="">Todos</option>
      <option value="pendiente">Pendiente</option>
      <option value="completada">Completada</option>
    </select>
  </div>

  <div id="listaTareas" class="grid gap-3"></div>

  <template id="tpl-tarea">
    <article class="rounded-2xl border border-gray-200 p-4 shadow-sm bg-white">
      <div class="flex items-start justify-between gap-4">
        <div class="min-w-0">
          <h4 class="font-medium text-gray-900 truncate" data-field="title"></h4>
          <p class="text-sm text-gray-500 mt-1 line-clamp-2" data-field="description"></p>
          <div class="mt-2 flex flex-wrap gap-3 text-sm text-gray-500">
            <span>Vence: <span data-field="due_at"></span></span>
            <span>Pts: <span data-field="points"></span></span>
            <span>Estado: <span data-field="status"
              class="px-2 py-0.5 rounded-full text-xs bg-gray-100 text-gray-700"></span></span>
          </div>
        </div>

        <!-- Acciones profesor -->
        <div class="hidden items-center gap-2" data-field="actions">
          <button data-action="editar"
            class="px-3 py-1.5 rounded-lg border border-gray-200 hover:bg-gray-50">Editar</button>
          <button data-action="toggle"
            class="px-3 py-1.5 rounded-lg border border-gray-200 hover:bg-gray-50">Completar</button>
          <button data-action="eliminar"
            class="px-3 py-1.5 rounded-lg border border-red-200 text-red-700 hover:bg-red-50">Eliminar</button>
        </div>

        <!-- Acciones estudiante -->
        <div class="hidden items-center gap-2" data-field="student-actions">
          <button data-action="entregar"
            class="px-3 py-1.5 rounded-lg border border-emerald-200 text-emerald-700 hover:bg-emerald-50">Entregar</button>
          <a data-action="ver" class="px-3 py-1.5 rounded-lg border border-gray-200 hover:bg-gray-50"
             href="#" target="_blank" rel="noopener">Ver mi última entrega</a>
          <button data-action="eliminar-entrega"
            class="px-3 py-1.5 rounded-lg border border-red-200 text-red-700 hover:bg-red-50 hidden">Eliminar entrega</button>
        </div>
      </div>
    </article>
  </template>

  <dialog id="modalTarea" class="rounded-2xl p-0 w-full max-w-xl backdrop:bg-black/30">
    <form id="formTarea" class="p-6 space-y-4">
      <h4 id="modalTitulo" class="text-lg font-semibold">Nueva tarea</h4>
      <input type="hidden" name="id">

      <label class="grid gap-1">
        <span class="text-sm text-gray-700">Título</span>
        <input name="title" required
          class="px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
      </label>

      <label class="grid gap-1">
        <span class="text-sm text-gray-700">Descripción</span>
        <textarea name="description" rows="4"
          class="px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500"></textarea>
      </label>

      <div class="grid grid-cols-2 gap-3">
        <label class="grid gap-1">
          <span class="text-sm text-gray-700">Vence (fecha y hora)</span>
          <input name="due_at" type="datetime-local" required
            class="px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
        </label>
        <label class="grid gap-1">
          <span class="text-sm text-gray-700">Puntos</span>
          <input name="points" type="number" min="0" value="100"
            class="px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500">
        </label>
      </div>

      <div class="pt-2 flex items-center justify-end gap-2">
        <button type="button" id="btnCancelarModal"
          class="px-4 py-2 rounded-xl border border-gray-200 hover:bg-gray-50">Cancelar</button>
        <button type="submit"
          class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Guardar</button>
      </div>
    </form>
  </dialog>

  <!-- Modal de entrega (estudiante) -->
  <dialog id="modalEntrega" class="rounded-2xl p-0 w-full max-w-md backdrop:bg-black/30">
    <form id="formEntrega" class="p-6 space-y-4" method="post" action="/api/entregas?action=subir" enctype="multipart/form-data">
      <h4 class="text-lg font-semibold">Entregar archivo</h4>
      <input type="hidden" name="tarea_id">
      <input type="hidden" name="curso_id">
      <div class="text-xs text-gray-600">Archivo actual: <span id="archivoActual">—</span></div>
      <label class="grid gap-1">
        <span class="text-sm text-gray-700">Archivo (máx 2 MB)</span>
        <input type="file" name="archivo" required
          class="px-3 py-2 rounded-xl border border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <span id="pesoArchivo" class="text-xs text-gray-500">—</span>
      </label>
      <div class="pt-2 flex items-center justify-end gap-2">
        <button type="button" id="btnCancelarEntrega"
          class="px-4 py-2 rounded-xl border border-gray-200 hover:bg-gray-50">Cancelar</button>
        <button type="submit"
          class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Subir</button>
      </div>
    </form>
  </dialog>
</section>
