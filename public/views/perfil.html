<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil de Usuario</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'green': {
              50: '#f0fdf4',
              100: '#dcfce7',
              200: '#bbf7d0',
              300: '#86efac',
              400: '#4ade80',
              500: '#22c55e',
              600: '#16a34a',
              700: '#15803d',
              800: '#166534',
              900: '#14532d',
            }
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">

<div id="header-container"></div>

<div class="container mx-auto px-6 py-8">
  <!-- Top Action Bar -->
  <div class="flex justify-end mb-6">
    <button class="flex items-center text-gray-600 hover:text-gray-800 border border-gray-300 hover:border-gray-400 transition-colors px-4 py-2 rounded-md bg-white">
      <i class="fas fa-redo mr-2"></i>
      Restablecer página a por defecto
    </button>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
    <!-- Left Sidebar -->
    <div class="xl:col-span-3 space-y-6">
      <!-- User Details -->
      <div class="bg-white/80 backdrop-blur-sm rounded-lg shadow-sm p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-800 flex items-center">
            <i class="fas fa-file-text mr-2 text-green-600"></i>
            Detalles de usuario
          </h3>
          <a href="#" class="text-green-600 hover:text-green-700 font-medium text-sm" id="editar-perfil">
            Editar perfil
          </a>
        </div>
        <div class="space-y-5">
          <div class="space-y-2">
            <div class="flex items-center text-gray-700 font-medium">
              <i class="fas fa-envelope mr-2 text-green-600"></i>
              Dirección de correo
            </div>
            <p class="text-sm text-gray-800 font-medium" id="correo-usuario"></p>
            <p class="text-xs text-gray-500 bg-gray-50 p-2 rounded-md">
              Visible para otros participantes del curso
            </p>
          </div>

          <hr class="border-gray-200">

          <div class="space-y-2">
            <div class="flex items-center text-gray-700 font-medium">
              <i class="fas fa-clock mr-2 text-green-600"></i>
              Zona horaria
            </div>
            <p class="text-sm text-gray-800 font-medium" id="zona-horaria"></p>
          </div>
        </div>
      </div>

      <!-- Privacy and Policies -->
      <div class="bg-white/80 backdrop-blur-sm rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-semibold text-gray-800 flex items-center mb-4">
          <i class="fas fa-users mr-2 text-green-600"></i>
          Privacidad y Políticas
        </h3>
        <a href="#" class="text-green-600 hover:text-green-700 font-medium text-sm transition-colors duration-200 flex items-center">
          <i class="fas fa-file-text mr-2"></i>
          Resumen de retención de datos
        </a>
      </div>

      <!-- Miscellaneous -->
      <div class="bg-white/80 backdrop-blur-sm rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-semibold text-gray-800 flex items-center mb-4">
          <i class="fas fa-book-open mr-2 text-green-600"></i>
          Miscelánea
        </h3>
        <div class="space-y-3">
          <a href="#" class="flex items-center text-green-600 hover:text-green-700 font-medium text-sm transition-colors duration-200 p-2 hover:bg-green-50 rounded-md">
            <i class="fas fa-file-text mr-3"></i>
            Entradas del blog
          </a>
          <a href="#" class="flex items-center text-green-600 hover:text-green-700 font-medium text-sm transition-colors duration-200 p-2 hover:bg-green-50 rounded-md">
            <i class="fas fa-comment-dots mr-3"></i>
            Mensajes en foros
          </a>
          <a href="#" class="flex items-center text-green-600 hover:text-green-700 font-medium text-sm transition-colors duration-200 p-2 hover:bg-green-50 rounded-md">
            <i class="fas fa-users mr-3"></i>
            Foros de discusión
          </a>
          <a href="#" class="flex items-center text-green-600 hover:text-green-700 font-medium text-sm transition-colors duration-200 p-2 hover:bg-green-50 rounded-md">
            <i class="fas fa-book-open mr-3"></i>
            Planes de aprendizaje
          </a>
        </div>
      </div>
    </div>

    <!-- Main Profile Content -->
    <div class="xl:col-span-6">
      <div class="bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-8">
        <div class="flex flex-col sm:flex-row items-center sm:items-start space-y-4 sm:space-y-0 sm:space-x-6">
          <div class="h-24 w-24 bg-gradient-to-br from-green-100 to-green-200 text-green-700 text-3xl font-bold border-4 border-white shadow-lg rounded-full flex items-center justify-center">
            <span class="text-2xl" id="iniciales-usuario"></span>
          </div>
          <div class="flex-1 text-center sm:text-left">
            <h1 class="text-3xl font-bold text-gray-800 mb-3 leading-tight" id="nombre-completo"></h1>
            <button class="bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2 rounded-md transition-colors duration-200 flex items-center mx-auto sm:mx-0">
              <i class="fas fa-comment mr-2"></i>
              Enviar Mensaje
            </button>
          </div>
        </div>
      </div>

      <!-- Cursos del Usuario -->
      <div class="mt-8">
        <div class="bg-white/80 backdrop-blur-sm rounded-lg shadow-sm p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-book-open mr-2 text-green-600"></i>
            Mis Cursos
          </h3>
          <div id="cursos-usuario" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Cursos cargados dinámicamente -->
          </div>
        </div>
      </div>
    </div>

    <!-- Right Sidebar -->
    <div class="xl:col-span-3 space-y-6">
      <!-- Reports -->
      <div class="bg-white/80 backdrop-blur-sm rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-semibold text-gray-800 flex items-center mb-4">
          <i class="fas fa-chart-bar mr-2 text-green-600"></i>
          Informes
        </h3>
        <div class="space-y-3">
          <a href="#" class="flex items-center text-green-600 hover:text-green-700 font-medium text-sm transition-colors duration-200 p-2 hover:bg-green-50 rounded-md">
            <i class="fas fa-calendar mr-3"></i>
            Sesiones del navegador
          </a>
          <a href="#" class="flex items-center text-green-600 hover:text-green-700 font-medium text-sm transition-colors duration-200 p-2 hover:bg-green-50 rounded-md">
            <i class="fas fa-chart-bar mr-3"></i>
            Resumen de Calificaciones
          </a>
        </div>
      </div>

      <!-- Access Activity -->
      <div class="bg-white/80 backdrop-blur-sm rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-semibold text-gray-800 flex items-center mb-4">
          <i class="fas fa-clock mr-2 text-green-600"></i>
          Actividad de accesos
        </h3>
        <div class="space-y-5" id="actividad-accesos">
          <!-- Accesos cargados dinámicamente -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Help Button -->
<div class="fixed bottom-6 right-6">
  <button class="rounded-full bg-green-600 hover:bg-green-700 text-white p-3 h-12 w-12 shadow-lg hover:shadow-xl transition-all duration-200">
    <i class="fas fa-question-circle text-lg"></i>
  </button>
</div>

<script>
  // Cargar header
  fetch('/views/header.html')
    .then(res => res.text())
    .then(html => {
      const container = document.getElementById('header-container');
      container.innerHTML = html;

      const scripts = container.querySelectorAll('script');
      scripts.forEach(oldScript => {
        const newScript = document.createElement('script');
        if (oldScript.src) newScript.src = oldScript.src;
        else newScript.textContent = oldScript.textContent;
        document.body.appendChild(newScript);
        oldScript.remove();
      });
    });

  // Cargar perfil y cursos
  async function cargarPerfil() {
    try {
      const res = await fetch('/api/perfil', { credentials: 'include' });
      if (!res.ok) throw new Error('No se pudo cargar el perfil');
      const usuario = await res.json();

      document.getElementById('correo-usuario').textContent = usuario.email || '';
      document.getElementById('zona-horaria').textContent = usuario.timezone || '';
      document.getElementById('nombre-completo').textContent = usuario.nombre || '';
      const iniciales = usuario.nombre?.split(' ').map(n => n[0]).join('').toUpperCase() || '';
      document.getElementById('iniciales-usuario').textContent = iniciales;

// Cargar cursos
const cursosRes = await fetch(`/api/cursos?action=obtener`, { credentials: 'include' });
const todosCursos = await cursosRes.json();
const cursos = todosCursos.filter(c => c.estudiantes.some(e => e.id === usuario.id)); // solo los cursos del usuario


      // Cargar actividad de accesos
      const accesos = usuario.accesos || [];
      const accContainer = document.getElementById('actividad-accesos');
      accContainer.innerHTML = '';
      accesos.forEach(a => {
        const color = a.tipo === 'ultimo' ? 'blue' : 'green';
        const div = document.createElement('div');
        div.className = `bg-${color}-50 p-4 rounded-lg border-l-4 border-${color}-500`;
        div.innerHTML = `
          <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
            <i class="fas fa-calendar mr-2 text-${color}-600"></i>
            ${a.titulo}
          </h4>
          <p class="text-sm text-gray-700 font-medium">${a.fecha}</p>
          <p class="text-xs text-gray-500 mt-1 bg-white px-2 py-1 rounded">${a.duracion}</p>
        `;
        accContainer.appendChild(div);
      });

    } catch (err) {
      console.error(err);
      alert('Error al cargar perfil de usuario');
    }
  }

  cargarPerfil();
</script>

</body>
</html>
