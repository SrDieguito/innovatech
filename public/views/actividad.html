<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Actividad - Sistema de Calificaciones</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <style>
    /* Animaciones y estilos mejorados */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes bounce {
      0%, 20%, 53%, 80%, 100% {
        transform: translate3d(0, 0, 0);
      }
      40%, 43% {
        transform: translate3d(0, -8px, 0);
      }
      70% {
        transform: translate3d(0, -4px, 0);
      }
      90% {
        transform: translate3d(0, -2px, 0);
      }
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out;
    }
    
    .animate-slideIn {
      animation: slideIn 0.3s ease-out;
    }
    
    .animate-pulse {
      animation: pulse 2s infinite;
    }
    
    .animate-bounce {
      animation: bounce 1s infinite;
    }
    
    .animate-shimmer {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 1000px 100%;
      animation: shimmer 2s infinite;
    }
    
    .calification-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .calification-badge.excellent {
      background-color: #10B981;
      color: white;
      box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
    }
    
    .calification-badge.good {
      background-color: #F59E0B;
      color: white;
      box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
    }
    
    .calification-badge.poor {
      background-color: #EF4444;
      color: white;
      box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
    }
    
    .calification-badge.pending {
      background-color: #9CA3AF;
      color: white;
      box-shadow: 0 4px 6px rgba(156, 163, 175, 0.3);
    }
    
    /* Toast de notificación mejorado */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      color: white;
      border-radius: 12px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      z-index: 1000;
      display: flex;
      align-items: center;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }
    
    .toast.success {
      background: linear-gradient(135deg, #10B981, #059669);
    }
    
    .toast.error {
      background: linear-gradient(135deg, #EF4444, #DC2626);
    }
    
    .toast.warning {
      background: linear-gradient(135deg, #F59E0B, #D97706);
    }
    
    .toast.info {
      background: linear-gradient(135deg, #3B82F6, #2563EB);
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }
    
    .toast-icon {
      margin-right: 12px;
      font-size: 20px;
    }
    
    /* Modal mejorado */
    dialog {
      border: none;
      border-radius: 16px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      padding: 0;
      animation: fadeIn 0.3s ease-out;
    }
    
    dialog::backdrop {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    /* Botones mejorados */
    .btn-primary {
      background: linear-gradient(135deg, #10B981, #059669);
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(16, 185, 129, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #3B82F6, #2563EB);
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(59, 130, 246, 0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #EF4444, #DC2626);
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
    }
    
    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(239, 68, 68, 0.4);
    }
    
    /* Tarjetas mejoradas */
    .card {
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      overflow: hidden;
    }
    
    .card:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }
    
    /* Estados de carga */
    .skeleton {
      background-color: #e5e7eb;
      border-radius: 6px;
      display: inline-block;
      position: relative;
      overflow: hidden;
    }
    
    .skeleton::after {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      transform: translateX(-100%);
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shimmer 1.5s infinite;
    }
    
    /* Efectos de entrada para elementos */
    .stagger-item {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    
    .stagger-item.visible {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Scroll personalizado */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #c5c5c5;
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

  <div id="header-container"></div>
  
  <!-- Toast de notificación mejorado -->
  <div id="toast" class="toast hidden">
    <i id="toast-icon" class="toast-icon"></i>
    <span id="toast-message" class="text-sm font-medium"></span>
  </div>

  <main class="flex-grow px-4 py-8">
    <div class="max-w-5xl mx-auto space-y-6">

      <!-- Botón de regresar -->
      <div class="flex justify-start">
        <button id="btn-regresar" class="flex items-center text-emerald-600 hover:text-emerald-700 transition transform hover:-translate-x-1">
          <i class="fas fa-arrow-left mr-2 transition-transform duration-300 group-hover:-translate-x-1"></i>
          <span class="group-hover:underline">Regresar al curso</span>
        </button>
      </div>

      <!-- Título -->
      <div class="animate-fadeIn">
        <div id="title-skeleton" class="skeleton h-9 w-64 mb-2"></div>
        <div id="desc-skeleton" class="skeleton h-5 w-80"></div>
        <h1 id="actividad-title" class="text-3xl font-bold text-emerald-700 text-center sm:text-left hidden">Cargando...</h1>
        <p id="actividad-description" class="text-gray-600 mt-1 text-center sm:text-left hidden"></p>
      </div>

      <!-- Detalles de la tarea -->
      <div class="card bg-white p-6 space-y-4 animate-fadeIn" style="animation-delay: 0.1s">
        <h2 class="text-lg font-semibold text-gray-800 border-b pb-2 flex items-center">
          <i class="fas fa-info-circle mr-2 text-emerald-600"></i>
          Detalles de la tarea
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
          <p class="stagger-item"><span class="font-medium text-gray-700 flex items-center"><i class="fas fa-calendar-plus mr-2 text-emerald-600"></i>Fecha de creación:</span> <span id="actividad-created_at" class="text-gray-600">—</span></p>
          <p class="stagger-item" style="animation-delay: 0.1s"><span class="font-medium text-gray-700 flex items-center"><i class="fas fa-hourglass-end mr-2 text-amber-600"></i>Fecha límite:</span> <span id="actividad-due_at" class="text-gray-600">—</span></p>
          <p id="estado-container" class="stagger-item" style="animation-delay: 0.2s"><span class="font-medium text-gray-700 flex items-center"><i class="fas fa-tasks mr-2 text-blue-600"></i>Estado:</span> <span id="actividad-status" class="px-3 py-1 rounded-full text-xs bg-gray-100 text-gray-800">—</span></p>
          <p class="stagger-item" style="animation-delay: 0.3s"><span class="font-medium text-gray-700 flex items-center"><i class="fas fa-star mr-2 text-yellow-500"></i>Puntos:</span> <span id="actividad-points" class="text-gray-600">0</span></p>
          <p id="profesor-container" class="stagger-item" style="animation-delay: 0.4s"><span class="font-medium text-gray-700 flex items-center"><i class="fas fa-chalkboard-teacher mr-2 text-purple-600"></i>Profesor:</span> <span id="actividad-profesor" class="text-gray-600">—</span></p>
          <p id="entrega-container" class="stagger-item" style="animation-delay: 0.5s"><span class="font-medium text-gray-700 flex items-center"><i class="fas fa-file-upload mr-2 text-indigo-600"></i>Última entrega:</span> <span id="actividad-ultima-entrega" class="text-gray-600">—</span></p>
        </div>
      </div>

      <!-- Contenedor de botones independiente, centrado -->
      <div id="actividad-buttons" class="flex flex-wrap gap-3 mt-4 justify-center animate-fadeIn" style="animation-delay: 0.2s"></div>

      <!-- Calificación (solo para estudiantes) -->
      <div id="calificacion-container" class="card bg-white p-6 animate-fadeIn" style="animation-delay: 0.3s">
        <h2 class="text-lg font-semibold text-gray-800 border-b pb-2 mb-4 flex items-center">
          <i class="fas fa-star-half-alt mr-2 text-yellow-500"></i>
          Calificación
        </h2>
        <div id="actividad-calificacion" class="text-center text-gray-600 py-4">
          <div class="flex flex-col items-center justify-center">
            <i class="fas fa-clock text-3xl text-gray-400 mb-2"></i>
            <span>Aún no calificado</span>
          </div>
        </div>
      </div>

      <!-- Sección de comentarios -->
      <div id="comentarios-container" class="card bg-white p-6 animate-fadeIn" style="animation-delay: 0.4s">
        <h2 class="text-lg font-semibold text-gray-800 border-b pb-2 mb-4 flex items-center">
          <i class="fas fa-comments mr-2 text-blue-600"></i>
          Comentarios
        </h2>
        <div id="comentarios-list" class="space-y-4 max-h-80 overflow-y-auto custom-scrollbar py-2">
          <div class="text-center text-gray-500 py-8">
            <i class="fas fa-comment-slash text-3xl mb-2"></i>
            <p>Sin comentarios aún</p>
          </div>
        </div>

        <!-- Formulario de comentario -->
        <form id="formComentario" class="mt-6 flex gap-2 bg-gray-50 p-3 rounded-xl">
          <input 
            type="text" 
            name="comentario" 
            placeholder="Escribe un comentario..." 
            required
            class="flex-1 px-4 py-2 border-0 rounded-xl bg-white focus:ring-2 focus:ring-emerald-500 focus:outline-none shadow-sm"
          >
          <button 
            type="submit" 
            class="px-4 py-2 btn-primary text-white rounded-xl flex items-center"
          >
            <i class="fas fa-paper-plane mr-2"></i>
            Enviar
          </button>
        </form>
      </div>
    </div>

    <!-- CONTENEDOR DE ENTREGAS DEL PROFESOR -->
    <div id="profesor-entregas" class="card bg-white p-6 mt-6 hidden animate-fadeIn">
      <h2 class="text-lg font-semibold text-gray-800 border-b pb-2 mb-4 flex items-center">
        <i class="fas fa-file-download mr-2 text-indigo-600"></i>
        Entregas de estudiantes
      </h2>
      <div class="mb-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
        <span class="text-sm text-gray-600 flex items-center">
          <i class="fas fa-file-alt mr-2"></i>
          Mostrando <span id="entregas-count" class="font-medium mx-1">0</span> entregas
        </span>
        <button id="btn-exportar" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition flex items-center">
          <i class="fas fa-file-export mr-2"></i>
          Exportar calificaciones
        </button>
      </div>
      <div id="entregas-list" class="space-y-4">
        <div class="text-center py-8">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-emerald-600"></div>
          <p class="text-gray-500 mt-2">Cargando entregas...</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Modal para calificar entrega -->
  <dialog id="modal-calificar" class="w-11/12 max-w-md p-0 rounded-xl">
    <div class="p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
          <i class="fas fa-star mr-2 text-yellow-500"></i>
          Calificar entrega
        </h3>
        <button id="close-calificar" class="text-gray-400 hover:text-gray-600 transition">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Estudiante</label>
          <p id="calificar-estudiante" class="text-gray-600 bg-gray-50 p-3 rounded-lg">—</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Calificación</label>
          <input 
            type="number" 
            id="calificacion-input" 
            min="0" 
            step="0.1" 
            max="100" 
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500"
          >
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Comentario (opcional)</label>
          <textarea 
            id="calificar-comentario" 
            rows="3" 
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500"
            placeholder="Agrega un comentario sobre la entrega..."
          ></textarea>
        </div>
      </div>
      <div class="flex justify-end gap-3 mt-6">
        <button id="cancel-calificar" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
          Cancelar
        </button>
        <button id="save-calificacion" class="px-4 py-2 btn-primary text-white rounded-lg flex items-center">
          <i class="fas fa-save mr-2"></i>
          Guardar calificación
        </button>
      </div>
    </div>
  </dialog>

  <!-- Modal para ver entrega -->
  <dialog id="modal-entrega" class="w-11/12 max-w-2xl p-0 rounded-xl">
    <div class="p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
          <i class="fas fa-file-alt mr-2 text-indigo-600"></i>
          Detalles de entrega
        </h3>
        <button id="close-entrega" class="text-gray-400 hover:text-gray-600 transition">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Estudiante</label>
          <p id="entrega-estudiante" class="text-gray-600 bg-gray-50 p-3 rounded-lg">—</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de entrega</label>
          <p id="entrega-fecha" class="text-gray-600 bg-gray-50 p-3 rounded-lg">—</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Archivos adjuntos</label>
          <div id="entrega-archivos" class="bg-gray-50 p-3 rounded-lg">
            <p class="text-gray-500 text-center">No hay archivos adjuntos</p>
          </div>
        </div>
        <div id="entrega-calificacion-container">
          <label class="block text-sm font-medium text-gray-700 mb-1">Calificación</label>
          <div id="entrega-calificacion" class="bg-gray-50 p-3 rounded-lg">
            <p class="text-gray-500 text-center">Sin calificar</p>
          </div>
        </div>
      </div>
      <div class="flex justify-end mt-6">
        <button id="close-entrega-btn" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
          Cerrar
        </button>
      </div>
    </div>
  </dialog>

  <script>
    // Función para mostrar notificaciones toast
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      const toastIcon = document.getElementById('toast-icon');
      const toastMessage = document.getElementById('toast-message');
      
      // Configurar según el tipo
      const icons = {
        success: 'fas fa-check-circle',
        error: 'fas fa-exclamation-circle',
        warning: 'fas fa-exclamation-triangle',
        info: 'fas fa-info-circle'
      };
      
      // Aplicar estilos según el tipo
      toast.className = `toast ${type}`;
      toastIcon.className = `toast-icon ${icons[type]}`;
      toastMessage.textContent = message;
      
      // Mostrar el toast
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('show'), 10);
      
      // Ocultar después de 5 segundos
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.classList.add('hidden'), 400);
      }, 5000);
    }

    // Función para formatear fechas
    function formatDate(dateString) {
      if (!dateString) return '—';
      const date = new Date(dateString);
      return date.toLocaleDateString('es-ES', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Función para determinar el estado de la actividad
    function getStatus(dueDate) {
      if (!dueDate) return 'pending';
      const now = new Date();
      const due = new Date(dueDate);
      return now > due ? 'overdue' : 'pending';
    }

    // Función para obtener el texto del estado
    function getStatusText(status) {
      const statuses = {
        'completed': 'Completada',
        'overdue': 'Vencida',
        'pending': 'Pendiente',
        'not_submitted': 'No entregada'
      };
      return statuses[status] || 'Desconocido';
    }

    // Función para obtener el color del estado
    function getStatusColor(status) {
      const colors = {
        'completed': 'bg-emerald-100 text-emerald-800',
        'overdue': 'bg-red-100 text-red-800',
        'pending': 'bg-amber-100 text-amber-800',
        'not_submitted': 'bg-gray-100 text-gray-800'
      };
      return colors[status] || 'bg-gray-100 text-gray-800';
    }

    // Función para mostrar la calificación con estilo
    function displayCalificacion(calificacion) {
      const container = document.getElementById('actividad-calificacion');
      
      if (!calificacion || calificacion.calificacion === null) {
        container.innerHTML = `
          <div class="flex flex-col items-center justify-center">
            <i class="fas fa-clock text-3xl text-gray-400 mb-2"></i>
            <span>Aún no calificado</span>
          </div>
        `;
        return;
      }
      
      const score = parseFloat(calificacion.calificacion);
      let badgeClass = 'calification-badge ';
      
      if (score >= 90) badgeClass += 'excellent';
      else if (score >= 70) badgeClass += 'good';
      else badgeClass += 'poor';
      
      container.innerHTML = `
        <div class="flex flex-col items-center justify-center">
          <div class="${badgeClass} mb-2 animate-pulse">
            ${score}
          </div>
          <div class="text-center">
            <p class="font-medium">${score}/100 puntos</p>
            ${calificacion.comentario ? `<p class="text-sm text-gray-600 mt-2">"${calificacion.comentario}"</p>` : ''}
          </div>
        </div>
      `;
    }

    // Función para cargar los detalles de la actividad
    function loadActividadDetails() {
      // Simular carga con esqueletos
      setTimeout(() => {
        // Ocultar esqueletos y mostrar contenido real
        document.getElementById('title-skeleton').classList.add('hidden');
        document.getElementById('desc-skeleton').classList.add('hidden');
        document.getElementById('actividad-title').classList.remove('hidden');
        document.getElementById('actividad-description').classList.remove('hidden');
        
        // Establecer valores (en una aplicación real, estos vendrían de una API)
        document.getElementById('actividad-title').textContent = 'Examen Final de Matemáticas';
        document.getElementById('actividad-description').textContent = 'Examen que cubre todos los temas vistos durante el semestre.';
        document.getElementById('actividad-created_at').textContent = formatDate('2023-05-10T08:00:00');
        document.getElementById('actividad-due_at').textContent = formatDate('2023-06-15T23:59:00');
        document.getElementById('actividad-points').textContent = '100';
        document.getElementById('actividad-profesor').textContent = 'Dr. Carlos Mendoza';
        document.getElementById('actividad-ultima-entrega').textContent = formatDate('2023-06-15T22:30:45');
        
        // Establecer estado
        const status = getStatus('2023-06-15T23:59:00');
        const statusElement = document.getElementById('actividad-status');
        statusElement.textContent = getStatusText(status);
        statusElement.className = `px-3 py-1 rounded-full text-xs ${getStatusColor(status)}`;
        
        // Mostrar elementos con animación escalonada
        document.querySelectorAll('.stagger-item').forEach((item, index) => {
          setTimeout(() => {
            item.classList.add('visible');
          }, index * 100);
        });
        
        // Mostrar calificación (simulada)
        displayCalificacion({ calificacion: 92.5, comentario: 'Excelente trabajo. Muy bien organizado.' });
        
        // Mostrar botones según el rol (simulado como estudiante)
        renderButtons('student');
        
        // Mostrar comentarios (simulados)
        renderComentarios([
          { usuario: 'María González', texto: '¿El examen es con libro abierto?', fecha: '2023-06-10T14:30:00' },
          { usuario: 'Dr. Carlos Mendoza', texto: 'No, el examen es cerrado. Solo se permite calculadora científica.', fecha: '2023-06-10T15:15:00' },
          { usuario: 'Juan Pérez', texto: '¿Cuánto tiempo tenemos para completarlo?', fecha: '2023-06-12T09:45:00' }
        ]);
      }, 1500);
    }

    // Función para renderizar botones según el rol
    function renderButtons(role) {
      const buttonsContainer = document.getElementById('actividad-buttons');
      
      if (role === 'student') {
        buttonsContainer.innerHTML = `
          <button class="px-5 py-2.5 btn-primary text-white rounded-xl flex items-center animate-fadeIn" style="animation-delay: 0.1s">
            <i class="fas fa-file-upload mr-2"></i>
            Subir entrega
          </button>
          <button class="px-5 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition flex items-center animate-fadeIn" style="animation-delay: 0.2s">
            <i class="fas fa-eye mr-2"></i>
            Ver entrega
          </button>
          <button class="px-5 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition flex items-center animate-fadeIn" style="animation-delay: 0.3s">
            <i class="fas fa-download mr-2"></i>
            Descargar actividad
          </button>
        `;
      } else if (role === 'teacher') {
        buttonsContainer.innerHTML = `
          <button class="px-5 py-2.5 btn-secondary text-white rounded-xl flex items-center animate-fadeIn" style="animation-delay: 0.1s">
            <i class="fas fa-edit mr-2"></i>
            Editar actividad
          </button>
          <button class="px-5 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition flex items-center animate-fadeIn" style="animation-delay: 0.2s">
            <i class="fas fa-download mr-2"></i>
            Descargar actividad
          </button>
          <button class="px-5 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition flex items-center animate-fadeIn" style="animation-delay: 0.3s">
            <i class="fas fa-trash-alt mr-2"></i>
            Eliminar actividad
          </button>
        `;
        // Mostrar sección de entregas para profesores
        document.getElementById('profesor-entregas').classList.remove('hidden');
        // Cargar entregas (simuladas)
        loadEntregas();
      }
    }

    // Función para renderizar comentarios
    function renderComentarios(comentarios) {
      const comentariosList = document.getElementById('comentarios-list');
      
      if (!comentarios || comentarios.length === 0) {
        comentariosList.innerHTML = `
          <div class="text-center text-gray-500 py-8">
            <i class="fas fa-comment-slash text-3xl mb-2"></i>
            <p>Sin comentarios aún</p>
          </div>
        `;
        return;
      }
      
      comentariosList.innerHTML = comentarios.map((comentario, index) => `
        <div class="stagger-item bg-gray-50 p-4 rounded-xl" style="animation-delay: ${index * 0.1}s">
          <div class="flex justify-between items-start">
            <span class="font-medium text-emerald-700">${comentario.usuario}</span>
            <span class="text-sm text-gray-500">${formatDate(comentario.fecha)}</span>
          </div>
          <p class="mt-2 text-gray-700">${comentario.texto}</p>
        </div>
      `).join('');
      
      // Mostrar elementos con animación escalonada
      setTimeout(() => {
        document.querySelectorAll('#comentarios-list .stagger-item').forEach((item, index) => {
          setTimeout(() => {
            item.classList.add('visible');
          }, index * 100);
        });
      }, 300);
    }

    // Función para cargar entregas (simuladas)
    function loadEntregas() {
      setTimeout(() => {
        const entregas = [
          { id: 1, estudiante: 'María González', fecha: '2023-06-15T22:30:45', calificacion: 92.5, comentario: 'Excelente trabajo' },
          { id: 2, estudiante: 'Juan Pérez', fecha: '2023-06-15T23:45:12', calificacion: 78.0, comentario: 'Buen intento' },
          { id: 3, estudiante: 'Laura Sánchez', fecha: '2023-06-14T18:20:33', calificacion: null, comentario: null },
          { id: 4, estudiante: 'Carlos Ruiz', fecha: null, calificacion: null, comentario: null }
        ];
        
        renderEntregas(entregas);
      }, 1000);
    }

    // Función para renderizar entregas
    function renderEntregas(entregas) {
      const entregasList = document.getElementById('entregas-list');
      const entregasCount = document.getElementById('entregas-count');
      
      entregasCount.textContent = entregas.length;
      
      if (!entregas || entregas.length === 0) {
        entregasList.innerHTML = `
          <div class="text-center py-8 text-gray-500">
            <i class="fas fa-inbox text-3xl mb-2"></i>
            <p>No hay entregas aún</p>
          </div>
        `;
        return;
      }
      
      entregasList.innerHTML = entregas.map((entrega, index) => {
        const hasSubmission = entrega.fecha !== null;
        const isGraded = entrega.calificacion !== null;
        
        return `
          <div class="stagger-item bg-white border border-gray-200 rounded-xl p-4 hover:shadow-md transition" style="animation-delay: ${index * 0.1}s">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
              <div class="flex-1">
                <h3 class="font-medium text-gray-800">${entrega.estudiante}</h3>
                <div class="flex flex-wrap items-center gap-2 mt-1">
                  <span class="text-sm ${hasSubmission ? 'text-emerald-600' : 'text-gray-500'}">
                    <i class="fas ${hasSubmission ? 'fa-check-circle' : 'fa-times-circle'} mr-1"></i>
                    ${hasSubmission ? 'Entregado' : 'Sin entregar'}
                  </span>
                  <span class="text-sm text-gray-500">•</span>
                  <span class="text-sm text-gray-500">
                    ${hasSubmission ? formatDate(entrega.fecha) : '—'}
                  </span>
                </div>
              </div>
              <div class="flex items-center gap-2">
                ${isGraded ? `
                  <div class="calification-badge ${entrega.calificacion >= 90 ? 'excellent' : entrega.calificacion >= 70 ? 'good' : 'poor'}">
                    ${entrega.calificacion}
                  </div>
                ` : hasSubmission ? `
                  <span class="text-sm text-amber-600 bg-amber-100 px-3 py-1 rounded-full">
                    <i class="fas fa-clock mr-1"></i> Por calificar
                  </span>
                ` : ''}
                <button class="p-2 text-gray-500 hover:text-emerald-600 transition" onclick="verEntrega(${entrega.id})">
                  <i class="fas fa-eye"></i>
                </button>
                ${hasSubmission && !isGraded ? `
                  <button class="p-2 text-gray-500 hover:text-yellow-600 transition" onclick="calificarEntrega(${entrega.id})">
                    <i class="fas fa-star"></i>
                  </button>
                ` : ''}
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      // Mostrar elementos con animación escalonada
      setTimeout(() => {
        document.querySelectorAll('#entregas-list .stagger-item').forEach((item, index) => {
          setTimeout(() => {
            item.classList.add('visible');
          }, index * 100);
        });
      }, 300);
    }

    // Función para calificar una entrega
    function calificarEntrega(id) {
      // En una aplicación real, se cargarían los datos reales de la entrega
      document.getElementById('calificar-estudiante').textContent = `Estudiante #${id}`;
      document.getElementById('calificacion-input').value = '';
      document.getElementById('calificar-comentario').value = '';
      
      const modal = document.getElementById('modal-calificar');
      modal.showModal();
    }

    // Función para ver una entrega
    function verEntrega(id) {
      // En una aplicación real, se cargarían los datos reales de la entrega
      document.getElementById('entrega-estudiante').textContent = `Estudiante #${id}`;
      document.getElementById('entrega-fecha').textContent = formatDate('2023-06-15T22:30:45');
      
      const modal = document.getElementById('modal-entrega');
      modal.showModal();
    }

    // Inicialización cuando el DOM está cargado
    document.addEventListener('DOMContentLoaded', function() {
      // Cargar detalles de la actividad
      loadActividadDetails();
      
      // Manejar el envío de comentarios
      document.getElementById('formComentario').addEventListener('submit', function(e) {
        e.preventDefault();
        const comentarioInput = this.elements['comentario'];
        const comentario = comentarioInput.value.trim();
        
        if (comentario) {
          // Simular envío de comentario
          showToast('Comentario enviado correctamente', 'success');
          comentarioInput.value = '';
          
          // En una aplicación real, aquí se enviaría el comentario al servidor
        }
      });
      
      // Manejar el botón de regresar
      document.getElementById('btn-regresar').addEventListener('click', function() {
        showToast('Redirigiendo al curso...', 'info');
        // En una aplicación real, aquí se redirigiría a la página del curso
      });
      
      // Manejar el botón de exportar
      document.getElementById('btn-exportar').addEventListener('click', function() {
        showToast('Exportando calificaciones...', 'info');
        // En una aplicación real, aquí se exportarían las calificaciones
      });
      
      // Manejar el modal de calificación
      document.getElementById('close-calificar').addEventListener('click', function() {
        document.getElementById('modal-calificar').close();
      });
      
      document.getElementById('cancel-calificar').addEventListener('click', function() {
        document.getElementById('modal-calificar').close();
      });
      
      document.getElementById('save-calificacion').addEventListener('click', function() {
        const calificacion = document.getElementById('calificacion-input').value;
        const comentario = document.getElementById('calificar-comentario').value;
        
        if (calificacion && calificacion >= 0 && calificacion <= 100) {
          showToast('Calificación guardada correctamente', 'success');
          document.getElementById('modal-calificar').close();
          // En una aplicación real, aquí se guardaría la calificación
        } else {
          showToast('Por favor ingresa una calificación válida (0-100)', 'error');
        }
      });
      
      // Manejar el modal de entrega
      document.getElementById('close-entrega').addEventListener('click', function() {
        document.getElementById('modal-entrega').close();
      });
      
      document.getElementById('close-entrega-btn').addEventListener('click', function() {
        document.getElementById('modal-entrega').close();
      });
    });

    // Hacer las funciones globales para los onclick en los botones
    window.calificarEntrega = calificarEntrega;
    window.verEntrega = verEntrega;
  </script>
</body>
</html>
